var VM={};!function(){var e=j_m.currPage;e.hook(function(){var t=$(j_m.currPage[0]),i=e.vm;i?i.sendPhoneCode():i=e.vm=new Vue({el:t[0],data:{video_id:j_m.cateHash.video_id,video_title:"",video_desc:"",username:"",mobile:"",authcode:"",shoot_location:"",shoot_city:"",shoot_time:"",tag_ids:"",v:{},atags:[],userinfo:{}},ready:function(){Junb.addClass(e[0],"ready"),j_m.compilePage(),setTimeout(function(){i.sendPhoneCode(),j_m.compilePage()},100)},set:function(e){},methods:{fnSub:function(e){var t=this,i=this.$data;t.formateForm()&&setUserinfo(function(e){e.mobile_no?t.modifyVideo():Util.callService({url:oUserinfo.addr["interface"]+"/index.php?d=account&c=account&m=bindMobile",paras:{mobile:i.mobile,authcode:i.authcode,username:i.username},callback:function(e){0===+e.errcode?(t.modifyVideo(),setUserinfo(null,!0)):4005==+e.errcode?Util.Alert("验证码错误"):4015==+e.errcode&&Util.Alert("该手机号码已经被绑定")}})})},formateForm:function(){if(!isFormatedForNull())return!1;if(!oUserinfo.info.mobile_no){if(!Util.checkMobile(i.mobile))return Util.Alert("请输入正确的手机号码"),!1;if(!Util.checkLimitCode(i.authcode,"num",6,6))return Util.Alert("请输入正确的验证码"),!1}return!0},modifyVideo:function(){var e=this.$data;Util.callService({url:oUserinfo.addr["interface"]+"/index.php?d=account&c=video&m=modifyVideoDetail",paras:{video_id:j_m.cateHash.video_id,video_title:e.video_title,video_desc:e.video_desc,shoot_location:e.shoot_location,shoot_city:e.shoot_city,shoot_time:e.shoot_time,tag_ids:e.tag_ids},callback:function(e){0===+e.errcode?j_m.changeHash("success"):Util.Alert("操作失败，请认真检查后再提交")}})},sendPhoneCode:function(){var e=t.find("#edit-upload-codebt"),o=t.find("#edit-upload-phone");$.VerifiCode({bt:e,num:o,delay:30,check:function(){return e.hasClass("on")?void 0:!1},callback:function(){Util.callService({url:oUserinfo.addr["interface"]+"/index.php?d=account&c=account&m=sendAuthcode",paras:{mobile:i.mobile,sms_type:"1"},callback:function(e){}})},fnWrong:function(){Util.Alert("手机号格式错误")}})},toggleTag:function(e,t){this.getItmById("tag_id",this.atags,e,function(e){e.c=!e.c,i.tag_ids=function(){for(var e="",t=i.atags,o=0;o<t.length;o++)t[o].c&&(e+=t[o].tag_id);return e.split("").join(",")}()})},getItmById:function(e,t,i,o){for(var a=0;a<t.length;a++)if(i==t[a][e])return o&&o(t[a]),!0;return!1}}}),setUserinfo(function(e){i.userinfo=e,i.$set("userinfo",e),i.$set("userinfo.mobile_no",e.mobile_no)}),Util.callService({url:oUserinfo.addr["interface"]+"/index.php?d=account&c=video&m=getVideoDetail",paras:{video_id:j_m.cateHash.video_id},callback:function(e){if(0==e.data.owner)return Util.Alert("您不具有修改该视频的权限"),void j_m.changeHash("main");i.v=e.data,i.shoot_time=i.v.create_time,i.shoot_city=i.v.shoot_city;var t=i.v.tags;Util.callService({url:oUserinfo.addr["interface"]+"/index.php?d=account&c=video&m=getTags",paras:{video_id:j_m.cateHash.video_id},callback:function(e){for(var o=i.atags=e.data,a=0;a<o.length;a++)i.$set("atags["+a+"]",o[a]),i.$set("atags["+a+"].c",o[a].c);if(t&&0!==t.length){for(var n=0;n<t.length;n++){var c=t[n].tag_id;i.getItmById("tag_id",o,c,function(e){e.c=!0,i.tag_ids+=c+","})}/\,$/.test(i.tag_ids)&&(i.tag_ids=i.tag_ids.substr(0,i.tag_ids.length-1))}}})}})})}();